
- 1. 2011年，`JDK7`发布，1.7u4中，开始启用新的垃圾回收器`G1`（但是不是默认）。
- 2. 2017年，发布`JDK9`，`G1`成为默认`GC`，代替`CMS`。
- 3. 2018年，发布`JDK11`，带来了革命性`ZGC`，性能比较强。

## 虚拟机介绍
虚拟机，就是虚拟的计算机，可以执行一系列虚拟计算机指令，大体上可以分为系统虚拟机和程序虚拟机。它们运行时，都会受到虚拟机提供的资源的限制。

- 系统虚拟机：仿真模拟系统的，比如`Visual Box`，`VMware`。
- 程序虚拟机：为执行单个计算机程序设计的，比如`Java`虚拟机。

## JAVA虚拟机
`Java`虚拟机是一台执行字节码的虚拟机计算机，但是字节码不一定是由`Java`语言编译而成。但是只要使用这一套虚拟机规则的语言，就可以享受到跨平台，垃圾收集以及可靠的即时编译器。`JVM`和硬件之间没有直接的交互。

- 一次编译，到处运行。
- 自动内存管理
- 自动垃圾回收

下面是ava平台文档中Java概念图的描述，可以看出`javac`命令在`JDK`中，也就是将`.java`文件编译成为`.class`文件，这个就是前端编译器，将源文件编译成为字节码。这个编译器不在`JRE`中，也说明了`JRE`不包括编译环境。

JRE和JDK都包括了JVM虚拟机。JRE是运行时环境，而JDK包含了开发环境。


JDK7 中java家族的结构组成 : https://docs.oracle.com/javase/7/docs/
![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/20210124190030.png)

JDK7 中java家族的结构组成 : https://docs.oracle.com/javase/8/docs/
![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/20210124190230.png)

## JVM结构

![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/20210124193442.png)

上面的图主要包括三部分：类加载器，运行时数据区，执行引擎。

类加载器，主要是将Class文件（已经经过前端编译器编译后的字节码文件），加载到运行时数据区，生成Class对象，这个过程会设计加载，链接，初始化等过程。

运行时区域主要分为：
- 线程私有（每个线程有一份）：
    - 程序计数器:`Program Count Register`,线程私有，没有垃圾回收
    - 虚拟机栈:`VM Stack`，线程私有，没有垃圾回收
    - 本地方法栈:`Native Method Stack`,线程私有，没有垃圾回收
- 线程共享：
    - 方法区:`Method Area`，以`HotSpot`为例，`JDK1.8`后元空间取代方法区，有垃圾回收。
    - 堆:`Heap`，垃圾回收最重要的地方。

执行引擎主要包括解释器和即时编译器（热点代码提前编译好，这是后端编译器），垃圾回收器。字节码文件不能直接被机器识别，所以需要执行引擎来做转换。

## Java代码执行流程
Java代码变成字节码文件的过程中，其实包含了词法分析，语法分析，语法树，语义分析等一系列操作。

![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/20210124203318.png)

在执行引擎中，有JIT编译器，也就是第二次编译的过程会发生在这里，会将热点代码编译成为机器指令，是按照方法的维度，缓存起来（放在方法区）。